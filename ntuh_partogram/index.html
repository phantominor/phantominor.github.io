<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blue Single Helper</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f0f8ff;
      color: #333;
    }
    h1 {
      color: #0066cc;
      text-align: center;
      margin-bottom: 30px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .input-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .main-block {
      margin-bottom: 30px;
    }
    .main-title {
      background-color: #0066cc;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .sub-block {
      margin-bottom: 20px;
    }
    .sub-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: #0066cc;
    }
    textarea {
      width: 100%;
      min-height: 150px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      resize: vertical;
      font-family: Arial, sans-serif;
    }
    .btn-submit {
      background-color: #0066cc;
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
      transition: background-color 0.3s;
    }
    .btn-submit:hover {
      background-color: #004999;
    }
    .hint {
      font-size: 13px;
      color: #777;
      margin-top: 5px;
      /* font-style: italic; */
    }
    .output-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: none;
    }
    .output-block {
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }
    .output-title {
      font-weight: bold;
      color: #0066cc;
      margin-bottom: 10px;
    }
    .output-content {
      background-color: #f9f9f9;
      padding: 10px;
      border-radius: 5px;
      border-left: 3px solid #0066cc;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Blue Single Helper</h1>
    
    <!-- Input Section -->
    <div class="input-section">
      <div class="main-block">
        <div class="main-title">入院紀錄 (Admission Note)</div>
        <div class="hint">Path: EMR > 住院 > [日期] > 入院紀錄 > [日期]</div>
        
        <div class="sub-block">
          <div class="sub-title">主訴 (Chief Complaint)</div>
          <textarea id="chiefComplaint" placeholder="Enter chief complaint here..."></textarea>
        </div>
        
        <div class="sub-block">
          <div class="sub-title">病史 (Patient History)</div>
          <textarea id="patientHistory" placeholder="Enter patient history here..."></textarea>
        </div>
        
        <div class="sub-block">
          <div class="sub-title">身體診察 (Physical Examination)</div>
          <textarea id="physicalExam" placeholder="Enter physical examination details here..."></textarea>
        </div>
        
        <div class="sub-block">
          <div class="sub-title">檢查紀錄 (Examination Report)</div>
          <textarea id="examReport" placeholder="Enter examination report here..."></textarea>
        </div>
      </div>
      
      <div class="main-block">
        <div class="main-title">病程紀錄 (Progress)</div>
        <div class="hint">Path: EMR > 住院 > [日期] > 病程紀錄 > [日期]</div>
        <div class="sub-block">
          <textarea id="progress" placeholder="Enter Antibiotics Note here..."></textarea>
        </div>
      </div>
      
      <div class="main-block">
        <div class="main-title">護理過程紀錄 (Nursing Process)</div>
        <div class="hint">Path: EMR > 住院 > [日期] > 護理紀錄 > 護理過程記錄</div>
        <div class="sub-block">
          <textarea id="nursingProcess" placeholder="Enter nursing process here..."></textarea>
        </div>
      </div>
      
      <div class="main-block">
        <div class="main-title">自然分娩處置暨評估紀錄 (NSD evaluation)</div>
        <div class="hint">Path: EMR > 住院 > [日期] > 自然分娩處置暨評估紀錄</div>
        <div class="sub-block">
          <textarea id="nsdEvaluation" placeholder="Enter NSD evaluation here..."></textarea>
        </div>
      </div>
      
      <button id="submitBtn" class="btn-submit">Submit</button>
    </div>
    
    <!-- Output Section -->
    <div id="outputSection" class="output-section">
      <div class="main-title">Organized Medical Data</div>
      
      <div class="output-block">
        <div class="output-title">1. OBS/GYN history</div>
        <div id="obsGynHistory" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">2. Special conditions or complications during this pregnancy course</div>
        <div id="specialConditions" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">3. Systemic disease</div>
        <div id="systemicDisease" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">4. Past major operation</div>
        <div id="pastOperation" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">5. Physical examination and laboratory data</div>
        <div id="physicalLabData" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">6. Pelvic examination</div>
        <div id="pelvicExam" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">7. Sonar finding</div>
        <div id="sonarFinding" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">8. Admission diagnosis</div>
        <div id="admissionDiagnosis" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">9. Labor course</div>
        <div id="laborCourse" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">10. Course of labor</div>
        <div id="courseOfLabor" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">11. Type of delivery</div>
        <div id="typeOfDelivery" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">12. Findings of placenta cord and membrane</div>
        <div id="placentaFindings" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">13. Findings of newborn</div>
        <div id="newbornFindings" class="output-content"></div>
      </div>
      
      <div class="output-block">
        <div class="output-title">14. Other finding</div>
        <div id="otherFindings" class="output-content"></div>
      </div>
    </div>
  </div>
  
  <script>
    document.getElementById('submitBtn').addEventListener('click', function() {
      // Extract data from input fields
      const patientHistoryText = document.getElementById('patientHistory').value;
      const examReportText = document.getElementById('examReport').value;
      
      // Extract OBS/GYN history from patient history
      let obsGynHistory = "";
      if (patientHistoryText.includes("8. OBGYN history:") && patientHistoryText.includes("9. Prenatal examination")) {
        const startIndex = patientHistoryText.indexOf("8. OBGYN history:") + "8. OBGYN history:".length;
        const endIndex = patientHistoryText.indexOf("9. Prenatal examination");
        obsGynHistory = patientHistoryText.substring(startIndex, endIndex).trim();
      }
      
      // Extract gestational age from patient history
      let gestationalAge = "";
      const pregnantWeeksRegex = /pregnant for (\d+\+\d+) weeks/;
      const pregnantMatch = patientHistoryText.match(pregnantWeeksRegex);
      if (pregnantMatch && pregnantMatch[1]) {
        gestationalAge = pregnantMatch[1];
      }
      
      // Extract Fetus information from examination report
      let fetusType = "";
      if (examReportText.includes("Fetus No :")) {
        const fetusLine = examReportText.substring(
          examReportText.indexOf("Fetus No :"),
          examReportText.indexOf("\n", examReportText.indexOf("Fetus No :"))
        );
        
        const fetusMatch = fetusLine.match(/Fetus No\s*:\s*(\S+)/);
        if (fetusMatch && fetusMatch[1]) {
          const fetusValue = fetusMatch[1].trim();
          
          // Determine fetus type based on value
          switch(fetusValue) {
            case "1":
              fetusType = "singleton";
              break;
            case "2":
              fetusType = "twins";
              break;
            case "3":
              fetusType = "triplets";
              break;
            case "DCDA":
              fetusType = "DCDA twins";
              break;
            case "MCDA":
              fetusType = "MCDA twins";
              break;
            case "MCMA":
              fetusType = "MCMA twins";
              break;
            default:
              fetusType = fetusValue; // For any other value, just use as is
          }
        }
      }
      
      // Combine the information
      let finalObsGynHistory = obsGynHistory;
      
      // Add gestational age if found
      if (gestationalAge) {
        finalObsGynHistory += "\nGestational age: " + gestationalAge + " weeks";
      }
      
      // Add fetus type if found
      if (fetusType) {
        finalObsGynHistory += "\n" + fetusType;
      }
      
      // Set the extracted data to the output fields
      document.getElementById('obsGynHistory').textContent = finalObsGynHistory;
      
      // Show the output section
      document.getElementById('outputSection').style.display = 'block';
      
      // Scroll to the output section
      document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
    });
    
    // Example data for testing - Patient History
    const examplePatientHistory = `【Present Illness】
This 29-year-old, gravida-1 para-0 woman is pregnant for 38+5 weeks. She received
regular prenatal examination at Dr.Lee's outpatient clinic.
NIPT revealed low risk for Down syndrome. Amniocentesis was not performed. Level II
sonography did show an echogenic spot at heart, stable under follow up.
Her blood pressure remained in the normal range during this gestation. OGTT test showed
negative for gestation diabetes. Group B streptococcus test revealed negative for
colonization. The pregnancy course was uneventful throughout the gestation. Neither
major anomaly of the fetus nor medical complications of the mother was found in the
serial follow-ups at our clinic.
Due to no labor signs, she was admitted for induction of labor.
【Past History】
1. Major systemic diseases: denied.
2. Current medication: denied.
 NTUH:Nil
 Other:Nil
 中草藥:Nil
 保健食品:Nil
3. Social history: smoking/alcohol/betel nut: denied.
4. Allergy: no known allergy.
 Adverse drug reactions: denied.
5. Operation history: denied.
6. Family history: diabetes mellitus(-), hypertension(-), preterm birth(-), others: no
major congenital malformation.
7. TOCC history: denied recent traveling, denied cluster or contact history.
8. OBGYN history:
G1P0, previous pregnant history: nil.
Menarche: 12 years old, menstrual cycle interval/duration: 28/5 days, last menstrual
period: 20240704, estimated date of confinement: 20250410.
9. Prenatal examination:
- Hypertension(-)
- Proteinuria(-)
- Gestational diabetes mellitus(-)
- Hepatitis B screening (HbsAg/HbeAg): -/-
- Result of group B streptococcus test: negative
Other prenatal exam finding:
- Level II sonography: an echogenic spot at heart, stable under follow up
- Amniocentesis: not performed
- aCGH: not performed: not performed
- SMA genetic testing: 1:3, (+); 配偶(盧冠勳A127497357): (-)
- Fragile X genetic testing: not performed
Vaccination during pregnancy: Tdap (Tetanus Toxoid, Reduced Diphtheria Toxoid, Acellular
Pertussis Vaccine)`;

    // Example data for testing - Examination Report
    const exampleExamReport = `檢查紀錄(Examination Report)
一般產科檢查報告 (婦產部)
 病患姓名 : 鄭郁璇 病歷號碼 : 6496259 病床號碼 : 09PW0501
 年齡 :30 性別 : F
 檢查日期 : 20250401 檢查項目 : 19003CYC
LMP : 20240704 G : 1 P : 0 EDC : 20250410 GW1(LMP) : 38.7 wk
Fetus No : 1 Presentation : vertex FHB : + Gender : M
 CRL : cm
 GS diameter : X mm
 BPD : 90.0 mm 36.5 wk ( <2 %) ↓
 OFD : 110.5 mm
 ↓
 BPDa : 88.7 mm 35.9 wk ( <2 %)
 AC : 319 mm 37.2 wk ( 29 %) ↓
 HC : 314.9 mm 35.7 wk
 FL : 70.5 mm 40.5 wk ( 75 %) ↓
 EBW : 2801.8 Gram GW2(US) =37.1 wk Location :
 AFI : 49.3 + 22.0 + 12.0 + 49.3 = 132.6 mm
Placenta location :left lateral wall grade : Ⅱ
Uterus & adnexa : UmA S/D 2.22
Level I Impression :
 Pregnancy for 36 weeks, AGA.
 檢查者 : / 張威仁住院醫師 / 李建南主治醫師`;
    
    // Function to fill in example data
    function fillExampleData() {
      document.getElementById('patientHistory').value = examplePatientHistory;
      document.getElementById('examReport').value = exampleExamReport;
    }
    
    // Uncomment the line below if you want to auto-fill example data when page loads
    fillExampleData();
  </script>
</body>
</html>